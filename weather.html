<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather App</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>

<body>
    <div class="row">
        <div class="col-md-12" id="titleBar">
            <strong>Weather Dashboard</strong>
        </div>
    </div>

    <div class="row">
        <div class="col-md-3" id="searchSection">

            <div class="container">

                <h1 id="searchCity">Search for a city:</h1>
                <input type="text" id="searchBar" />
                <button type="button" class="btn btn-success" id="searchButton">Search</button>

                <div class="row">
                    <div class="col" id="previousSearchResults">

                        <div class="list-group" id="list-tab" role="tablist">

                            <a class="list-group-item list-group-item-action" id="list-home-list" data-toggle="list"
                                href="#list-home" role="tab" aria-controls="home">Home</a>

                            <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list"
                                href="#list-profile" role="tab" aria-controls="profile">Profile</a>

                            <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list"
                                href="#list-messages" role="tab" aria-controls="messages">Messages</a>

                            <a class="list-group-item list-group-item-action" id="list-settings-list" data-toggle="list"
                                href="#list-settings" role="tab" aria-controls="settings">Settings</a>
                        </div>

                    </div>
                </div>

            </div>

        </div>


        <div class="col-md-9">
            <div class="row" id="todayForecast">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title" id="cityName">City:</h2>
                            <p class="weather-card" id="temperature">Temperature:</p>
                            <p class="weather-card" id="humidity">Humidity:</p>
                            <p class="weather-card" id="windSpeed">Wind Speed:</p>
                            <p class="weather-card" id="UVIndexDiv">UV Index:</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container">
                <div class="row" id="fiveDayForecast">
                    <h2 id="fiveDayTitle">5-Day Forecast:</h2>
                    <div id="fiveDaySection"></div>
                </div>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>.
        <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

        <script>
            $("#searchButton").on("click", function (event) {
                event.preventDefault;
                var city = $(this).siblings("input").val();
                var todayQueryURL = "https://api.openweathermap.org/data/2.5/weather?q=" + city + "&appid=2521198802838b4440f00e66a7aa70a5";

                $.ajax({
                    url: todayQueryURL,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);

                    //Temperature is returned in Kelvin, so here it is converted to Fahrenheit and rounded to the second decimal place.
                    var tempKelvin = response.main.temp;
                    var tempFahrenheit = ((tempKelvin - 273.15) * 9 / 5 + 32).toFixed(2);
                    var date = moment().format("l");

                    // $("#weather_image").attr("src", "http://openweathermap.org/img/w/" + response.weather[0].icon + ".png");
                    $("#cityName").text("City: " + response.name + " " + date);
                    $("#temperature").text("Temperature: " + tempFahrenheit + "Â°F");
                    $("#humidity").text("Humidity: " + response.main.humidity + "%");
                    $("#windSpeed").text("Wind Speed: " + response.wind.speed + " MPH");

                    var longitude = JSON.stringify(response.coord.lon);
                    var latitude = JSON.stringify(response.coord.lat);
                    var UVqueryURL = "http://api.openweathermap.org/data/2.5/uvi?lat=" + latitude + "&lon=" + longitude + "&appid=2521198802838b4440f00e66a7aa70a5";

                    $.ajax({
                        url: UVqueryURL,
                        method: "GET"
                    }).then(function (response) {
                        console.log(response);

                        var UVIndex = response.value;
                        $("#UVIndexDiv").text("UV Index: ");
                        
                        //I need to make a div inside the title div and give it the UV value and the respective class attribute so it doesnt take up the screen
                        var UVbutton = $("<button>");
                        UVbutton.text(UVIndex);
                        $("#UVIndexDiv").append(UVbutton);

                        if (UVIndex < 3) {
                            $(UVbutton).removeClass("UVmoderate");
                            $(UVbutton).removeClass("UVsevere");
                            $(UVbutton).removeClass("UVdangerous");
                            $(UVbutton).addClass("UVmild");
                        } else if (UVIndex < 6) {
                            $(UVbutton).removeClass("UVmild");
                            $(UVbutton).removeClass("UVsevere");
                            $(UVbutton).removeClass("UVdangerous");
                            $(UVbutton).addClass("UVmoderate");
                        } else if (UVIndex < 10) {
                            $(UVbutton).removeClass("UVmoderate");
                            $(UVbutton).removeClass("UVmild");
                            $(UVbutton).removeClass("UVdangerous");
                            $(UVbutton).addClass("UVsevere");
                        } else {
                            $(UVbutton).removeClass("UVmoderate");
                            $(UVbutton).removeClass("UVsevere");
                            $(UVbutton).removeClass("UVmild");
                            $(UVbutton).addClass("UVdangerous");
                        };
                    });
                });

                var fiveDayQueryURL = "http://api.openweathermap.org/data/2.5/forecast?q=" + city + "&appid=2521198802838b4440f00e66a7aa70a5";

                $.ajax({
                    url: fiveDayQueryURL,
                    method: "GET"
                }).then(function (response) {
                    console.log(response);
                    $("#fiveDaySection").empty();

                    for (var i = 0; i < 5; i++) {
                        var forecastDiv = $("<div>");
                        forecastDiv.addClass("forecastDiv");
                        $("#fiveDaySection").append(forecastDiv);
                    }

                });
            });
        </script>

</body>



</html>